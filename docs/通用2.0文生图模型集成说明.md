# é€šç”¨2.0æ–‡ç”Ÿå›¾æ¨¡å‹é›†æˆè¯´æ˜

## ğŸ“‹ æ¦‚è¿°

é¡¹ç›®å·²æˆåŠŸé›†æˆç«å±±å¼•æ“é€šç”¨2.0æ–‡ç”Ÿå›¾æ¨¡å‹ï¼ˆ`high_aes_general_v20_L`ï¼‰ï¼Œè¯¥æ¨¡å‹ç›¸æ¯”ä¹‹å‰çš„ç‰ˆæœ¬å…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š

- **åŸç”Ÿä¸­è‹±æ–‡åŒè¯­æ”¯æŒ**
- **å›¾æ–‡åŒ¹é…åº¦å’Œç¾æ„Ÿå¤§å¹…æå‡**
- **æ”¯æŒè¶…åˆ†åŠŸèƒ½ï¼ˆå¼€å¯ååˆ†è¾¨ç‡ç¿»å€ï¼‰**
- **æ”¯æŒpromptæ‰©å†™åŠŸèƒ½**

## ğŸ”„ ä¸»è¦å˜æ›´

### 1. SDK æ›´æ¢
- **æ—§ç‰ˆ**: ä½¿ç”¨ `volcenginesdkarkruntime` (Ark SDK)
- **æ–°ç‰ˆ**: ä½¿ç”¨ `volcengine.visual.VisualService` (Visual Service SDK)

### 2. API æ¥å£å˜æ›´
- **æ—§ç‰ˆ**: `client.images.generate()`
- **æ–°ç‰ˆ**: `visual_service.cv_process()`

### 3. è¯·æ±‚å‚æ•°ç»“æ„è°ƒæ•´
```python
# æ–°çš„è¯·æ±‚å‚æ•°æ ¼å¼
form = {
    "req_key": "high_aes_general_v20_L",
    "prompt": prompt,
    "seed": -1,
    "scale": 3.5,
    "ddim_steps": 16,
    "width": 512,
    "height": 512,
    "use_sr": True,        # å¼€å¯è¶…åˆ†åŠŸèƒ½
    "use_rephraser": True, # å¼€å¯promptæ‰©å†™
    "return_url": True,
    "logo_info": {
        "add_logo": False,
        "position": 0,
        "language": 0,
        "opacity": 0.3
    }
}
```

## âš™ï¸ é…ç½®æ›´æ–°

### config.yaml å˜æ›´
```yaml
api:
  volcengine:
    # é€šç”¨2.0æ–‡ç”Ÿå›¾æ¨¡å‹APIå¯†é’¥ï¼ˆVisual Serviceè®¤è¯ï¼‰
    access_key_id: "your_access_key_id_here"     # Visual Serviceçš„AccessKey ID
    secret_access_key: "your_secret_key_here"   # Visual Serviceçš„SecretAccessKey
    region: "cn-north-1"                         # é€šç”¨2.0æ¨¡å‹ä½¿ç”¨cn-north-1
    
    # å…¼å®¹æ—§é…ç½®ï¼ˆå¦‚æœåªæœ‰api_keyï¼Œä¹Ÿä¼šå°è¯•ä½¿ç”¨ï¼‰
    # api_key: "your_legacy_api_key"

models:
  text2image_endpoint: "high_aes_general_v20_L"  # å›ºå®šå€¼
```

## ğŸ”‘ APIå¯†é’¥é…ç½®

### é‡è¦è¯´æ˜
é€šç”¨2.0æ–‡ç”Ÿå›¾æ¨¡å‹ä½¿ç”¨çš„æ˜¯ **Visual Service API**ï¼Œä¸æ˜¯ Ark APIï¼Œéœ€è¦åŒé‡è®¤è¯é…ç½®ã€‚

### å¯†é’¥æ ¼å¼
```yaml
api:
  volcengine:
    access_key_id: "your_access_key_id_here"    # Visual Serviceçš„AccessKey ID
    secret_access_key: "your_secret_key_here"  # Visual Serviceçš„SecretAccessKey
    region: "cn-north-1"
```

### è·å–APIå¯†é’¥æ­¥éª¤
1. ç™»å½•ç«å±±å¼•æ“æ§åˆ¶å° (https://console.volcengine.com/)
2. è¿›å…¥"è®¿é—®æ§åˆ¶" â†’ "APIå¯†é’¥ç®¡ç†"
3. åˆ›å»ºæ–°çš„å¯†é’¥å¯¹ï¼Œè·å–:
   - AccessKey ID
   - SecretAccessKey
4. ç¡®ä¿å¯†é’¥æœ‰Visual Serviceçš„è®¿é—®æƒé™
5. åœ¨config.yamlä¸­é…ç½®ä¸Šè¿°å¯†é’¥

## ğŸ“¦ ä¾èµ–å®‰è£…

### å®‰è£…æ–°ç‰ˆSDK
```bash
pip uninstall volcengine-sdk-ark  # å¸è½½æ—§ç‰ˆSDKï¼ˆå¯é€‰ï¼‰
pip install volcengine           # å®‰è£…æ–°ç‰ˆVisual Service SDK
```

### éªŒè¯å®‰è£…
```bash
python -c "from volcengine.visual.VisualService import VisualService; print('å®‰è£…æˆåŠŸ')"
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ä½¿ç”¨
```python
from processors.image_gen import ImageGenerator

# åˆå§‹åŒ–
image_gen = ImageGenerator(config)

# ç”Ÿæˆå›¾ç‰‡
image_data = await image_gen._call_text2image_api("ä½ çš„æç¤ºè¯")
```

### é«˜çº§å‚æ•°è°ƒæ•´
å¯ä»¥åœ¨ `_call_text2image_api` æ–¹æ³•ä¸­è°ƒæ•´ä»¥ä¸‹å‚æ•°ï¼š

- **seed**: éšæœºç§å­ï¼ˆ-1è¡¨ç¤ºéšæœºï¼‰
- **scale**: æ–‡æœ¬å½±å“ç¨‹åº¦ï¼ˆ1-30ï¼‰
- **ddim_steps**: ç”Ÿæˆæ­¥æ•°ï¼ˆ1-50ï¼‰
- **width/height**: å›¾åƒå°ºå¯¸ï¼ˆ256-680ï¼‰
- **use_sr**: æ˜¯å¦å¼€å¯è¶…åˆ†
- **use_rephraser**: æ˜¯å¦å¼€å¯promptæ‰©å†™

## ğŸ§ª æµ‹è¯•éªŒè¯

### è¿è¡Œæµ‹è¯•è„šæœ¬
```bash
python test_new_image_model.py
```

### é¢„æœŸè¾“å‡º
```
============================================================
æµ‹è¯•é€šç”¨2.0æ–‡ç”Ÿå›¾æ¨¡å‹é›†æˆ
============================================================
[OK] é…ç½®åŠ è½½æˆåŠŸ
[OK] å›¾ç‰‡ç”Ÿæˆå™¨åˆå§‹åŒ–æˆåŠŸ
[OK] æç¤ºè¯æ„å»ºæˆåŠŸ: ...
[OK] å›¾ç‰‡ç”ŸæˆæˆåŠŸï¼è€—æ—¶: xx.xxç§’
[OK] æµ‹è¯•å›¾ç‰‡å·²ä¿å­˜åˆ°: ./data/temp/test_image_v2.jpg
============================================================
æµ‹è¯•å®Œæˆï¼
============================================================
```

## ğŸ¯ æ€§èƒ½ä¼˜åŠ¿

### 1. å›¾åƒè´¨é‡æå‡
- æ”¯æŒè¶…åˆ†åŠŸèƒ½ï¼Œè¾“å‡ºåˆ†è¾¨ç‡ç¿»å€
- æ›´å¥½çš„å›¾æ–‡åŒ¹é…åº¦
- å¢å¼ºçš„ç»†èŠ‚è¡¨ç°åŠ›

### 2. æ™ºèƒ½åŠŸèƒ½
- **Promptæ‰©å†™**: è‡ªåŠ¨ä¼˜åŒ–æç¤ºè¯
- **è¶…åˆ†å¢å¼º**: åŸç”Ÿæ”¯æŒ2å€è¶…åˆ†
- **å¤šé£æ ¼æ”¯æŒ**: é€šç”¨ç±»åˆ«æ•ˆæœæä½³

### 3. é…ç½®çµæ´»
- å¯è°ƒèŠ‚ç”Ÿæˆæ­¥æ•°å’Œè´¨é‡
- æ”¯æŒéšæœºç§å­æ§åˆ¶
- çµæ´»çš„å›¾åƒå°ºå¯¸è®¾ç½®

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

#### 1. ImportError: No module named 'volcengine'
```bash
pip install volcengine
```

#### 2. InvalidAccessKey é”™è¯¯
- æ£€æŸ¥APIå¯†é’¥æ˜¯å¦ä¸ºVisual Serviceå¯†é’¥
- ç¡®è®¤å¯†é’¥æƒé™æ˜¯å¦åŒ…å«æ–‡ç”Ÿå›¾åŠŸèƒ½
- éªŒè¯åŒºåŸŸè®¾ç½®æ˜¯å¦æ­£ç¡®ï¼ˆcn-north-1ï¼‰

#### 3. ç½‘ç»œè¶…æ—¶
- åœ¨config.yamlä¸­å¢åŠ request_timeout
- æ£€æŸ¥ç½‘ç»œè¿æ¥åˆ°ç«å±±å¼•æ“æœåŠ¡

#### 4. ç”Ÿæˆå¤±è´¥
- æ£€æŸ¥æç¤ºè¯æ˜¯å¦åŒ…å«æ•æ„Ÿå†…å®¹
- éªŒè¯è¯·æ±‚å‚æ•°æ˜¯å¦åœ¨å…è®¸èŒƒå›´å†…
- æŸ¥çœ‹ç«å±±å¼•æ“æ§åˆ¶å°çš„æœåŠ¡çŠ¶æ€

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [é€šç”¨2.0æ–‡ç”Ÿå›¾æ¨¡å‹è¯´æ˜æ–‡æ¡£](./docs/é€šç”¨2.0æ–‡ç”Ÿå›¾æ¨¡å‹è¯´æ˜æ–‡æ¡£.md)
- [é€šç”¨2.0æ¨¡å‹SDKä½¿ç”¨è¯´æ˜](./docs/é€šç”¨2.0æ¨¡å‹SDKä½¿ç”¨è¯´æ˜.md)
- [ç«å±±å¼•æ“å®˜æ–¹æ–‡æ¡£](https://www.volcengine.com/docs/)

## ğŸ”„ è¿ç§»æŒ‡å—

å¦‚æœæ‚¨ä»æ—§ç‰ˆæœ¬è¿ç§»ï¼š

1. **æ›´æ–°ä¾èµ–**: å®‰è£…æ–°çš„volcengine SDK
2. **é…ç½®å¯†é’¥**: è·å–å¹¶é…ç½®Visual Service APIå¯†é’¥
3. **æ›´æ–°é…ç½®**: ä¿®æ”¹config.yamlä¸­çš„regionå’Œendpoint
4. **æµ‹è¯•éªŒè¯**: è¿è¡Œtest_new_image_model.pyç¡®è®¤åŠŸèƒ½æ­£å¸¸

---

**æ³¨æ„**: æ–°æ¨¡å‹æä¾›æ›´å¥½çš„å›¾åƒè´¨é‡å’Œæ›´å¤šåŠŸèƒ½ï¼Œä½†éœ€è¦æ­£ç¡®é…ç½®APIå¯†é’¥æ‰èƒ½æ­£å¸¸ä½¿ç”¨ã€‚